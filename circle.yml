machine:
  node:
    version: 7.4
  services:
    - docker

general:
  artifacts:
    - "errorShots/"
test:
  pre:
    - npm run deploy
    - docker build -f Dockerfile.front -t serve-staging-nginx .
    - docker run -d -p 80:80 serve-staging-nginx
  override:
    - curl http://localhost:80
    - false && npm run test

deployment:
   release:
     tag: /v[0-9]+(\.[0-9]+)*/
     owner: rfit
     commands:
       - firebase -P production deploy -p deploy/production --token $FIREBASE_TOKEN
   staging:
     branch: [master]
     commands:
       - firebase -P staging deploy -p deploy/staging --token $FIREBASE_TOKEN
